---
title: 'Log plus Z'
Section: 'Scaling and Transformations'
Author: "Adam Dede"
Course: "Data to Decisions: Master Statistics with R and tidyverse"
Course_URL: "https://www.udemy.com/course/statsr_ad" 
output:
  html_document:
    toc: yes
    toc_float: yes
editor_options:
  chunk_output_type: console
---


## set environment

```{r message = FALSE, warning = FALSE}

# Set rendering parameters
knitr::opts_chunk$set(message = FALSE, warning = FALSE)

gitHubPath <- file.path(path.expand("~"), "GitHub", 
                        "MasterStatsUsingR")


library(tidyverse) # data manipulation and visualization
source(file.path(gitHubPath, 'courseTheme.R'))
library(pracma)

```

## human EEG data 

```{r EEG}
#load in the restingEEG dataset. 
#Key variable name: pow_delta_O
df = read.csv(file.path(gitHubPath, 'data',
                              'restingEEG.csv'))

df$dummy = as.factor(1) 
df <- df %>% filter(pow_delta_O < 250, pow_delta_O > 0)

ggplot(df, aes(x = pow_delta_O, color = dummy, fill = dummy)) + 
  geom_histogram() + 
  myTheme + brightFil + brightCol + theme(legend.position = 'none')

```

## TRANSFORM 1: What do EEG power values look like after log transform? 

```{r take log transform}

df$logPow_delta_O = log(df$pow_delta_O)

ggplot(df, aes(x = logPow_delta_O, color = dummy, fill = dummy)) + 
  geom_histogram() + 
  myTheme + brightFil + brightCol + theme(legend.position = 'none')+ 
  xlab('EEG delta power (log transformed)') 

#looks much more normal! 


```


## TRANSFORM 2: stack a z-transform on top of a log transform

```{r add z transform}

M = mean(df$logPow_delta_O)
S = sd(df$logPow_delta_O)

df$log_z_Pow_delta_O = (df$logPow_delta_O - M) / S




ggplot(df, aes(x = log_z_Pow_delta_O, 
               color = dummy, fill = dummy)) + 
  geom_histogram() + 
  myTheme + brightFil + brightCol + 
  theme(legend.position = 'none') + 
  xlab('EEG delta power (log and z transformed)') 


```

## using the z values to say things about the raw values

```{r say things about raw based on z}

#for this code block, z-score always refers to 
# z-score in the log transformed data

#what proportion of people have EEG delta power greater than 50? 

z = (log(50) - M) / S
1 - pnorm(log(50), M, S)
1 - pnorm(z)

#what EEG delta power values correspond to z scores of +- 1? 
exp(1*S+M)
exp(-1*S+M)

print(paste0("Z = -1 corresponds to a raw power value of: ", 
             round(exp(-1*S+M),2),
             ", and Z = +1 corresponds to a raw power value of: ", 
             round(exp(1*S+M),2)))

#What proportion of the raw data fall between these +-1 z-score? 
midPercent = sum(df$pow_delta_O>exp(-1*S+M) & 
                  df$pow_delta_O<exp(1*S+M)  ) / length(df$X) 

print(paste0(round(midPercent,2), 
             " of raw power values are between +- 1 z-score in the ",
             "log-transformed distribution"))



```

## how would the +- 1 z-score proportion change if we hadn't log transformed?

```{r no log}

M = mean(df$pow_delta_O)
S = sd(df$pow_delta_O)

midPercent = sum(df$pow_delta_O>(-1*S+M) & 
                    df$pow_delta_O<(1*S+M)  ) / length(df$X)  

print(paste0(round(midPercent,2), 
             " of raw power values are between +- 1 z-score in the ",
             "raw distribution"))



```


